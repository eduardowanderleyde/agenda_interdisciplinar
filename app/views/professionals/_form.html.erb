<div class="max-w-4xl mx-auto bg-white rounded-lg shadow p-16 space-y-12">
  <% if @professional.errors.any? %>
    <div class="mb-4 p-4 bg-red-100 text-red-800 rounded">
      <ul class="list-disc pl-5">
        <% @professional.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
  <%= simple_form_for(@professional) do |f| %>
    <%= f.error_notification %>
    <%= f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present? %>

    <div class="form-inputs space-y-8">
      <div>
        <%= f.input :name, input_html: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg' }, label_html: { class: 'block text-lg font-bold text-indigo-700 mb-3' } %>
      </div>
      <div class="mt-6">
        <label class="block text-lg font-bold text-indigo-700 mb-3">Especialidades</label>
        <div class="flex flex-wrap gap-4 mb-2">
          <% Specialty.all.each do |spec| %>
            <label class="inline-flex items-center mr-6 mb-2">
              <%= check_box_tag 'professional[specialty_ids][]', spec.id, @professional.specialty_ids.include?(spec.id), class: 'form-checkbox text-indigo-600 rounded' %>
              <span class="ml-2 text-sm"><%= spec.name %></span>
            </label>
          <% end %>
        </div>
      </div>
      <div class="mt-6" data-controller="horarios">
        <label class="block text-lg font-bold text-indigo-800 mb-4">Horários disponíveis por dia</label>
        <p class="text-sm text-gray-600 mb-2">Preencha <b>início</b> e <b>fim</b> para adicionar um intervalo. Exemplo: <b>12:00</b> até <b>14:00</b></p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <% dias_semana = [
            ['monday', 'Segunda'],
            ['tuesday', 'Terça'],
            ['wednesday', 'Quarta'],
            ['thursday', 'Quinta'],
            ['friday', 'Sexta']
          ] %>
          <% dias_semana.each do |dia_key, dia_label| %>
            <div class="mb-2 p-4 min-h-[80px] bg-gray-50 rounded shadow-sm flex flex-col gap-2 border border-gray-100">
              <div class="flex items-center mb-2 gap-2">
                <input type="checkbox" name="professional[available_days][]" value="<%= dia_key %>" <%= @professional.available_days&.include?(dia_key) ? 'checked' : '' %> class="form-checkbox h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                <label class="font-bold text-indigo-700 text-base select-none cursor-pointer"><%= dia_label %></label>
              </div>
              <div class="grid grid-cols-[auto_auto_auto_auto] items-center gap-2 mb-2">
                <input type="text" data-dia="<%= dia_key %>" maxlength="5" placeholder="Início (Ex: 12:00)" class="border rounded p-2 w-24 text-sm js-inicio" autocomplete="off" data-horarios-target="inicio">
                <span class="font-bold">até</span>
                <input type="text" data-dia="<%= dia_key %>" maxlength="5" placeholder="Fim (Ex: 14:00)" class="border rounded p-2 w-24 text-sm js-fim" autocomplete="off" data-horarios-target="fim">
                <button type="button" id="btn-adicionar-<%= dia_key %>" class="px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700 transition text-xs font-semibold shadow ml-2" data-action="click->horarios#addIntervalo" data-dia="<%= dia_key %>">Adicionar horário (JS)</button>
              </div>
              <ul id="lista-horarios-<%= dia_key %>" class="mt-2 flex flex-wrap gap-2" data-horarios-target="list" data-dia="<%= dia_key %>">
                <% ah = @professional.available_hours
                   if ah.is_a?(String)
                     begin
                       ah = JSON.parse(ah) rescue {}
                     rescue
                       ah = {}
                     end
                   end
                   if ah.is_a?(Array)
                     ah = { "all_days" => ah }
                   end
                   ah = {} unless ah.is_a?(Hash)
                   lista = Array(ah[dia_key])
                %>
                <% lista.each do |intervalo| %>
                  <li class="flex items-center bg-green-100 text-green-900 rounded px-3 py-1 mb-1 font-semibold text-xs shadow-sm">
                    <span><%= intervalo %></span>
                    <input type="hidden" name="professional[available_hours][<%= dia_key %>][]" value="<%= intervalo %>">
                    <button type="button" onclick="this.parentElement.remove()" class="ml-2 text-red-600 hover:text-red-800 font-bold text-lg bg-transparent border-none cursor-pointer">&times;</button>
                  </li>
                <% end %>
              </ul>
              <div class="text-red-600 text-xs" style="display:none;" data-horarios-target="error" data-dia="<%= dia_key %>"></div>
            </div>
          <% end %>
        </div>
        <small class="text-gray-500 block mt-2">Digite o horário de início e fim no formato 12:00, 14:00. O intervalo será salvo ao criar o profissional.</small>
      </div>
      <div class="mt-6">
        <label class="block text-lg font-bold text-indigo-700 mb-3">Duração padrão da sessão</label>
        <%= f.select :default_session_duration, options_for_select([["30 minutos", 30], ["45 minutos", 45], ["60 minutos", 60]], @professional.default_session_duration), {}, class: "block w-48 p-2 border rounded" %>
      </div>
    </div>

    <div class="form-actions flex justify-end pt-8 mb-8 mt-8">
      <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Criar novo Profissional</button>
    </div>
  <% end %>
</div>
