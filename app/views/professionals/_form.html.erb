<div class="max-w-4xl mx-auto bg-white rounded-lg shadow p-16 space-y-12">
  <%= simple_form_for(@professional) do |f| %>
    <%= f.error_notification %>
    <%= f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present? %>

    <div class="form-inputs space-y-8">
      <div>
        <%= f.input :name, input_html: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg' }, label_html: { class: 'block text-lg font-bold text-indigo-700 mb-3' } %>
      </div>
      <div class="mt-6">
        <label class="block text-lg font-bold text-indigo-700 mb-3">Especialidades</label>
        <div class="flex flex-wrap gap-4 mb-2">
          <% Specialty.all.each do |spec| %>
            <label class="inline-flex items-center mr-6 mb-2">
              <%= check_box_tag 'professional[specialty_ids][]', spec.id, @professional.specialty_ids.include?(spec.id), class: 'form-checkbox text-indigo-600 rounded' %>
              <span class="ml-2 text-sm"><%= spec.name %></span>
            </label>
          <% end %>
        </div>
      </div>
      <div class="mt-6" data-controller="horarios">
        <label class="block text-lg font-bold text-indigo-800 mb-4">Horários disponíveis por dia</label>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <% dias_semana = [
            ['monday', 'Segunda'],
            ['tuesday', 'Terça'],
            ['wednesday', 'Quarta'],
            ['thursday', 'Quinta'],
            ['friday', 'Sexta']
          ] %>
          <% dias_semana.each do |dia_key, dia_label| %>
            <div class="mb-2 p-4 min-h-[80px] bg-gray-50 rounded shadow-sm flex flex-col gap-2 border border-gray-100">
              <div class="flex items-center mb-2 gap-2">
                <input type="checkbox" name="professional[available_days][]" value="<%= dia_key %>" <%= @professional.available_days&.include?(dia_key) ? 'checked' : '' %> class="form-checkbox h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                <label class="font-bold text-indigo-700 text-base select-none cursor-pointer"><%= dia_label %></label>
              </div>
              <div class="grid grid-cols-[auto_auto_auto_auto] items-center gap-2 mb-2">
                <input type="text" data-dia="<%= dia_key %>" maxlength="5" placeholder="Início (Ex: 16h ou 16:00)" class="border rounded p-2 w-24 text-sm js-inicio" autocomplete="off">
                <span class="font-bold">até</span>
                <input type="text" data-dia="<%= dia_key %>" maxlength="5" placeholder="Fim (Ex: 18h ou 18:00)" class="border rounded p-2 w-24 text-sm js-fim" autocomplete="off">
                <button type="button" id="btn-adicionar-<%= dia_key %>" class="px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700 transition text-xs font-semibold shadow ml-2">Adicionar horário (JS)</button>
              </div>
              <ul id="lista-horarios-<%= dia_key %>" class="mt-2">
                <% (@professional.available_hours[dia_key] || []).each do |intervalo| %>
                  <li>
                    <%= intervalo %>
                    <input type="hidden" name="professional[available_hours][<%= dia_key %>][]" value="<%= intervalo %>">
                  </li>
                <% end %>
              </ul>
              <script>
                document.addEventListener('DOMContentLoaded', function() {
                  var btn = document.getElementById('btn-adicionar-<%= dia_key %>');
                  var lista = document.getElementById('lista-horarios-<%= dia_key %>');
                  btn.onclick = function() {
                    var inicio = document.querySelector('input.js-inicio[data-dia="<%= dia_key %>"]').value.trim();
                    var fim = document.querySelector('input.js-fim[data-dia="<%= dia_key %>"]').value.trim();
                    if (!inicio || !fim) {
                      alert('Preencha início e fim!');
                      return;
                    }
                    var texto = inicio + ' - ' + fim;
                    var li = document.createElement('li');
                    li.textContent = texto;
                    var input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'professional[available_hours][<%= dia_key %>][]';
                    input.value = texto;
                    li.appendChild(input);
                    lista.appendChild(li);
                    document.querySelector('input.js-inicio[data-dia="<%= dia_key %>"]').value = '';
                    document.querySelector('input.js-fim[data-dia="<%= dia_key %>"]').value = '';
                  };
                });
              </script>
              <div class="text-red-600 text-xs" style="display:none;"></div>
            </div>
          <% end %>
        </div>
        <small class="text-gray-500 block mt-2">Digite o horário de início e fim no formato 16h, 16:00, 18h, 18:00. O intervalo será salvo ao criar o profissional.</small>
      </div>
      <div class="mt-6">
        <label class="block text-lg font-bold text-indigo-700 mb-3">Duração padrão da sessão</label>
        <%= f.select :default_session_duration, options_for_select([["30 minutos", 30], ["45 minutos", 45], ["60 minutos", 60]], @professional.default_session_duration), {}, class: "block w-48 p-2 border rounded" %>
      </div>
    </div>

    <div class="form-actions flex justify-end pt-8 mb-8 mt-8">
      <%= f.button :submit, "Criar novo Profissional", class: "px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" %>
    </div>
  <% end %>
</div>
