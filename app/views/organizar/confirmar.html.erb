<div class="min-h-screen bg-gradient-to-br from-indigo-700 via-purple-600 to-blue-400 py-12 px-4">
  <div class="max-w-4xl mx-auto p-8 bg-white/30 rounded-3xl shadow-2xl backdrop-blur-md border border-white/20">
    <h1 class="text-3xl font-bold mb-8 text-white text-center drop-shadow">Confirmar Agenda</h1>
    <p class="mb-6 text-white text-center">Confira os agendamentos que serão criados. Conflitos serão destacados em vermelho.</p>

    <table class="w-full text-sm text-white mb-8 bg-white/20 rounded-xl overflow-hidden backdrop-blur-md">
      <thead>
        <tr class="border-b border-white/20">
          <th class="text-left p-2">Sala</th>
          <th class="text-left p-2">Profissional</th>
          <th class="text-left p-2">Paciente</th>
          <th class="text-left p-2">Início</th>
          <th class="text-left p-2">Fim</th>
          <th class="text-left p-2">Conflito</th>
        </tr>
      </thead>
      <tbody>
        <% @agenda["slots"].each do |slot| %>
          <% conflito = @conflitos.find { |c| c[:slot] == slot } %>
          <tr class="<%= conflito ? 'bg-red-200/80 text-red-800' : 'bg-white/10' %>">
            <td class="p-2"><%= slot["sala"] %></td>
            <td class="p-2"><%= slot["profissional"] %></td>
            <td class="p-2"><%= slot["paciente"] %></td>
            <td class="p-2"><%= slot["inicio"] %></td>
            <td class="p-2"><%= slot["fim"] %></td>
            <td class="p-2">
              <% if conflito %>
                <span class="font-semibold">
                  Conflito:
                  <% if conflito[:prof_conflict] %>Profissional <% end %>
                  <% if conflito[:room_conflict] %>Sala<% end %>
                </span>
              <% else %>
                <span class="text-green-200">OK</span>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <% if @conflitos.any? %>
      <div class="mb-6 p-4 bg-red-500/70 text-white rounded-lg font-semibold text-center">
        Existem conflitos! Ajuste a agenda ou escolha outra opção.
      </div>
    <% else %>
      <%= form_with url: escolher_agenda_path, method: :post, local: true do |f| %>
        <%= hidden_field_tag :agenda, @agenda.to_json %>
        <div class="mb-6">
          <%= f.label :notes, "Observação geral para esta agenda", class: "block font-semibold text-white mb-2" %>
          <%= f.text_area :notes, rows: 2, class: "w-full rounded-xl p-3 bg-white/80 text-gray-800 focus:ring-2 focus:ring-indigo-500" %>
        </div>
        <div class="text-center">
          <%= f.submit "Confirmar e Salvar Agenda", class: "bg-green-600 text-white px-8 py-4 rounded-xl hover:bg-green-700 text-lg font-bold shadow transition" %>
        </div>
      <% end %>
    <% end %>

    <div class="mt-6 text-center">
      <%= link_to "Voltar", organizar_path, class: "text-white underline hover:text-indigo-200 text-lg" %>
    </div>
  </div>
</div>
