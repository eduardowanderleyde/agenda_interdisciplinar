<% horas = []; t = Time.zone.parse('07:00'); while t <= Time.zone.parse('19:00'); horas << t.strftime('%H:%M'); t += 15.minutes; end %>
<% cor_tabela = (defined?(tabela_tipo) && tabela_tipo == 'sugestao') ? 'bg-blue-50' : '' %>
<div class="flex justify-center w-full">
  <div class="planner-full-table-container max-w-7xl mx-auto">
    <table class="planner-nicepage-table min-w-[900px] w-full border-separate border-spacing-0 <%= cor_tabela %> bg-white rounded-2xl shadow-2xl text-base">
      <thead>
        <tr>
          <th class="py-4 px-6 border-b-2 bg-green-100 text-green-900 text-lg font-extrabold sticky left-0 z-10">Horário</th>
          <% week_days.each do |dia| %>
            <th class="py-4 px-6 border-b-2 bg-blue-200 text-blue-900 text-lg font-extrabold">
              <div>
                <%= I18n.l(dia, format: '%A', locale: :'pt-BR') %><br><span class="text-base font-bold"><%= dia.strftime('%d/%m') %></span>
              </div>
            </th>
          <% end %>
        </tr>
      </thead>
      <tbody>
        <% horas.each do |hora| %>
          <tr>
            <td class="py-4 px-6 border-b bg-green-50 font-semibold text-green-900 sticky left-0 z-10 align-middle"><%= hora %></td>
            <% week_days.each do |dia| %>
              <% ag = grade[dia]&.dig(hora, selected_room.id) %>
              <td class="py-4 px-6 border-b align-top bg-white min-w-[180px] grade-droppable transition-colors hover:bg-blue-50"
                data-dia="<%= dia.strftime('%Y-%m-%d') %>"
                data-horario="<%= hora %>"
                data-sala="<%= selected_room.id %>">
                <% if ag.present? %>
                  <div class="mb-3 p-3 rounded-xl bg-blue-100 border border-blue-300 text-sm text-center shadow-lg grade-card cursor-move transition-transform hover:scale-105 hover:shadow-2xl" 
                    draggable="true" 
                    data-dia="<%= dia.strftime('%Y-%m-%d') %>" 
                    data-horario="<%= hora %>" 
                    data-sala="<%= selected_room.id %>"
                    data-patient-id="<%= ag[:patient_id] %>" 
                    data-professional-id="<%= ag[:professional_id] %>" 
                    data-specialty-id="<%= ag[:specialty_id] %>">
                    <div class="text-gray-700 mb-1">Paciente: <%= ag[:patient_name] %></div>
                    <div class="text-gray-700">Profissional: <%= ag[:professional_name] %></div>
                  </div>
                <% else %>
                  <span class="text-gray-300 font-semibold">Livre</span>
                <% end %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
<div class="flex justify-center mt-6">
  <button id="btn-salvar-alteracoes"
  class="bg-green-600 text-white px-8 py-3 text-lg font-bold rounded-xl shadow hover:bg-green-700 transition">Salvar alterações</button>
</div> 